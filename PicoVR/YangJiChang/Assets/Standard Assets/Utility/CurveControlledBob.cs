using System;
using UnityEngine;


namespace UnityStandardAssets.Utility
{
    [Serializable]
    public class CurveControlledBob     //曲线控制摆动
    {
        public float HorizontalBobRange = 0.33f;//水平摆动周期
        public float VerticalBobRange = 0.33f;//垂直摆动周期
        public AnimationCurve Bobcurve = new AnimationCurve(new Keyframe(0f, 0f), new Keyframe(0.5f, 1f),
                                                            new Keyframe(1f, 0f), new Keyframe(1.5f, -1f),
                                                            new Keyframe(2f, 0f)); // sin curve for head bob。头部摆动的正弦曲线。new Keyframe(时间，数值）
        public float VerticaltoHorizontalRatio = 1f;//垂直到水平旋转

        private float m_CyclePositionX;//循环位置X
        private float m_CyclePositionY;//循环位置Y
        private float m_BobBaseInterval;//摆动一般间隔
        private Vector3 m_OriginalCameraPosition;//原始摄像机位置
        private float m_Time;//


        public void Setup(Camera camera, float bobBaseInterval)//摄像机，摆动一般间隔
        {
            m_BobBaseInterval = bobBaseInterval;//
            m_OriginalCameraPosition = camera.transform.localPosition;//主摄像机的本地位置

            // get the length of the curve in time
            m_Time = Bobcurve[Bobcurve.length - 1].time;//
        }


        public Vector3 DoHeadBob(float speed)
        {
            float xPos = m_OriginalCameraPosition.x + (Bobcurve.Evaluate(m_CyclePositionX)*HorizontalBobRange);
            float yPos = m_OriginalCameraPosition.y + (Bobcurve.Evaluate(m_CyclePositionY)*VerticalBobRange);

            m_CyclePositionX += (speed*Time.deltaTime)/m_BobBaseInterval;
            m_CyclePositionY += ((speed*Time.deltaTime)/m_BobBaseInterval)*VerticaltoHorizontalRatio;

            if (m_CyclePositionX > m_Time)
            {
                m_CyclePositionX = m_CyclePositionX - m_Time;
            }
            if (m_CyclePositionY > m_Time)
            {
                m_CyclePositionY = m_CyclePositionY - m_Time;
            }

            return new Vector3(xPos, yPos, 0f);
        }
    }
}
